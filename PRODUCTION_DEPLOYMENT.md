# BrowGen Production Deployment Guide

## üöÄ Production Elevation Complete

All production-grade features have been implemented and are ready for deployment.

## üìã Environment Variables Checklist

### Required Variables (Set in Render Dashboard)

#### Backend Service (`browgen-backend`)
```bash
# Core
NODE_ENV=production
PORT=10000
DATABASE_URL=<auto-linked-from-render-postgres>
JWT_SECRET=<auto-generated-secure-value>
CORS_ORIGIN=https://browgen-frontend.onrender.com

# Redis (Required for caching and sessions)
REDIS_URL=<render-redis-connection-string>

# Email (Choose one)
SENDGRID_API_KEY=<your-sendgrid-api-key>
# OR
RESEND_API_KEY=<your-resend-api-key>
FROM_EMAIL=noreply@browgen.com
FROM_NAME=BrowGen Team

# Analytics & Monitoring
SENTRY_DSN=<your-sentry-dsn>
POSTHOG_API_KEY=<your-posthog-api-key>
POSTHOG_HOST=https://app.posthog.com

# Optional
STRIPE_SECRET_KEY=<for-future-payments>
FRONTEND_URL=https://browgen-frontend.onrender.com
```

#### Frontend Service (`browgen-frontend`)
```bash
# Core
NODE_ENV=production
PORT=10000
NEXT_PUBLIC_API_URL=<auto-linked-to-backend>

# Analytics (Optional)
NEXT_PUBLIC_POSTHOG_KEY=<your-posthog-public-key>
NEXT_PUBLIC_POSTHOG_HOST=https://app.posthog.com
```

## üóÑÔ∏è Database Setup Commands

### 1. Run Migrations (Automatic on Deploy)
```bash
# These run automatically via render.yaml buildCommand
npm run migrate
npm run seed
```

### 2. Manual Migration (if needed)
```bash
# Connect to Render PostgreSQL
psql $DATABASE_URL -f database/schema.sql
psql $DATABASE_URL -f database/seed.sql
```

## üß™ Smoke Test Scripts

### Backend API Tests
```bash
# Set your backend URL
BACKEND_URL="https://browgen-backend.onrender.com"

# Health check
curl -s "$BACKEND_URL/api/health" | jq .

# Test signup
curl -s -X POST "$BACKEND_URL/api/auth/signup" \
  -H "Content-Type: application/json" \
  -d '{"name":"Test User","email":"test@example.com","password":"testpass123"}' | jq .

# Test login
curl -s -X POST "$BACKEND_URL/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"testpass123"}' | jq .

# Test courses (should show cache headers)
curl -s -I "$BACKEND_URL/api/courses"

# Test gamification
TOKEN="<jwt-token-from-login>"
curl -s -H "Authorization: Bearer $TOKEN" "$BACKEND_URL/api/gamification/stats" | jq .

# Test Bro chatbot
curl -s -X POST "$BACKEND_URL/api/bro/trigger" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"trigger":"page_load","language":"en"}' | jq .
```

### Frontend Tests
```bash
FRONTEND_URL="https://browgen-frontend.onrender.com"

# Test pages
curl -s -I "$FRONTEND_URL"
curl -s -I "$FRONTEND_URL/learning"
curl -s -I "$FRONTEND_URL/dashboard"
curl -s -I "$FRONTEND_URL/admin"
```

### Redis Cache Verification
```bash
# Test course caching
curl -s -H "X-Cache: MISS" "$BACKEND_URL/api/courses"
curl -s -H "X-Cache: HIT" "$BACKEND_URL/api/courses"
```

## üéØ Feature Verification Checklist

### ‚úÖ Authentication & Security
- [x] Rate limiting on auth endpoints
- [x] Enhanced password hashing (bcrypt 12 rounds)
- [x] JWT token validation
- [x] Password reset flow with email
- [x] Security headers (helmet)
- [x] CORS configuration
- [x] Request logging and monitoring

### ‚úÖ Redis Caching
- [x] Course catalog caching (5min TTL)
- [x] Session management
- [x] Rate limiting storage
- [x] Leaderboard caching
- [x] Cache hit/miss headers

### ‚úÖ Bro Chatbot
- [x] Decision tree system
- [x] Context-aware responses
- [x] Multi-language support (EN/BN/HI)
- [x] Cooldown and daily limits
- [x] Integration with gamification

### ‚úÖ Gamification System
- [x] Points for actions (module complete, login, etc.)
- [x] Badge system with automatic awards
- [x] Streak tracking
- [x] Leaderboard with Redis caching
- [x] Progress integration

### ‚úÖ Email System
- [x] Welcome emails on signup
- [x] Password reset emails
- [x] Mentor booking confirmations
- [x] Weekly digest capability
- [x] SendGrid/Resend integration

### ‚úÖ Analytics & Monitoring
- [x] PostHog event tracking
- [x] Sentry error monitoring
- [x] API request analytics
- [x] User action tracking
- [x] Performance monitoring

### ‚úÖ Admin Panel
- [x] Dashboard with stats
- [x] User management (role changes)
- [x] Course CRUD operations
- [x] Blog post management
- [x] Analytics data
- [x] Protected admin routes

### ‚úÖ Internationalization
- [x] English (EN) - Complete
- [x] Bengali (BN) - Core features
- [x] Hindi (HI) - Core features
- [x] Language switcher component
- [x] Bro chatbot localization

## üîß Render Deployment Steps

### 1. Provision Redis
```bash
# In Render Dashboard:
# 1. Create new Redis instance
# 2. Copy connection URL
# 3. Add as REDIS_URL environment variable
```

### 2. Update render.yaml (Already configured)
```yaml
# The render.yaml is production-ready with:
# - PostgreSQL database
# - Backend web service with migrations
# - Frontend web service
# - All environment variables linked
```

### 3. Deploy
```bash
# Push to main branch
git push origin prod-elevate/ai-20250925

# Or merge to main and push
git checkout main
git merge prod-elevate/ai-20250925
git push origin main
```

## üìä Expected Performance

### Response Times
- API health check: < 100ms
- Course catalog (cached): < 50ms
- Course catalog (uncached): < 200ms
- User authentication: < 300ms
- Bro chatbot response: < 150ms

### Caching Hit Rates
- Course catalog: > 80%
- Leaderboard: > 90%
- User stats: > 70%

## üö® Monitoring & Alerts

### Sentry Alerts
- API errors (4xx/5xx responses)
- Database connection issues
- Authentication failures
- Email delivery failures

### PostHog Dashboards
- User signups and activity
- Course completion rates
- Bro chatbot interactions
- Gamification engagement

## üîÑ Rollback Plan

If issues occur:

1. **Immediate Rollback**:
   ```bash
   # In Render Dashboard:
   # 1. Go to service deployments
   # 2. Click "Rollback" on previous stable version
   ```

2. **Database Rollback** (if needed):
   ```bash
   # Restore from backup
   # Contact Render support for database restore
   ```

## üéâ Success Criteria

### All Tests Pass ‚úÖ
- [ ] Health endpoints return 200
- [ ] Auth flow works end-to-end
- [ ] Courses load with caching
- [ ] Bro chatbot responds
- [ ] Gamification awards points
- [ ] Admin panel accessible
- [ ] Email system sends messages
- [ ] Analytics track events

### Performance Metrics ‚úÖ
- [ ] Page load times < 2s
- [ ] API response times < 500ms
- [ ] Cache hit rate > 70%
- [ ] Error rate < 1%

### Feature Completeness ‚úÖ
- [ ] All 21 production tasks completed
- [ ] Security hardening implemented
- [ ] Monitoring and analytics active
- [ ] Admin capabilities functional
- [ ] Multi-language support working

## üìû Support & Maintenance

### Regular Tasks
- Monitor Sentry for errors
- Check PostHog analytics weekly
- Review user feedback
- Update course content
- Manage user roles via admin panel

### Scaling Considerations
- Redis memory usage
- Database connection limits
- API rate limiting adjustments
- CDN for static assets (future)

---

## üéØ Production URLs (After Deployment)

- **Frontend**: https://browgen-frontend.onrender.com
- **Backend API**: https://browgen-backend.onrender.com
- **Admin Panel**: https://browgen-frontend.onrender.com/admin
- **Health Check**: https://browgen-backend.onrender.com/api/health

**Deployment Status**: ‚úÖ Ready for Production
